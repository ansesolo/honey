<!-- Formulaire d'action principale (RÃ©colte, Production, Achat) -->
<div @click.self="showStockForm = false"
     class="bg-white rounded-lg shadow-xl p-6 border-2 border-honey-200"
     x-show="showStockForm"
     x-cloak
     x-effect="if(showStockForm) {products; autoSelectProduct();}">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold text-honey-800" x-text="getActionTitle(currentStockAction)"></h3>
        <button
                @click="closeStockForm()"
                class="text-gray-500 hover:text-gray-700 text-2xl">
            âœ•
        </button>
    </div>

    <form @submit.prevent="submitStockAction" class="space-y-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
                Date de l'opÃ©ration <span class="text-red-500">*</span>
            </label>
            <input
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    type="date"
                    required
                    x-model="stockActionForm.date">
        </div>

        <!-- SÃ©lection du produit (filtrÃ© selon la catÃ©gorie autorisÃ©e) -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
                Produit <span class="text-red-500">*</span>
            </label>
            <select
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    required
                    x-model="stockActionForm.productId"
                    :disabled="getFilteredProducts(currentStockAction).length <= 1">
                <option value="" disabled x-show="getFilteredProducts(currentStockAction).length === 0">
                    SÃ©lectionner un produit...
                </option>
                <template x-for="product in getFilteredProducts(currentStockAction)" :key="product.publicId">
                    <option :value="product.publicId" x-text="product.name"></option>
                </template>
            </select>
            <p x-show="getFilteredProducts(currentStockAction).length === 1"
               class="text-xs text-gray-400 mt-1 italic">
                SÃ©lection automatique (seul produit disponible pour cette action)
            </p>
        </div>

        <div x-show="shouldShowFlower()">
            <label class="block text-sm font-medium text-gray-700 mb-1">
                Fleur <span class="text-red-500">*</span>
            </label>
            <select
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    x-model="stockActionForm.flower">
                <option value="">
                    SÃ©lectionner un type de fleur...
                </option>
                <template x-for="flower in getDictionary('flowers')" :key="flower.id">
                    <option :value="flower.id" x-text="flower.label || '-'"></option>
                </template>
            </select>
        </div>

        <!-- QuantitÃ© -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
                QuantitÃ© (g ou unitÃ©)<span class="text-red-500">*</span>
            </label>
            <input
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    type="number"
                    min="0"
                    step="1"
                    required
                    x-model="stockActionForm.quantity">
        </div>

        <!-- Commentaire -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Commentaire</label>
            <textarea
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    rows="3"
                    x-model="stockActionForm.reason"
                    placeholder="Informations complÃ©mentaires..."></textarea>
        </div>

        <div class="flex justify-end gap-2 pt-4">
            <button
                    @click="showStockForm = false"
                    type="button"
                    class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition">
                Annuler
            </button>
            <button
                    :disabled="isLoading"
                    type="submit"
                    class="px-4 py-2 bg-gradient-to-r from-honey-500 to-bee-500 text-white rounded-md hover:from-honey-600 hover:to-bee-600 disabled:bg-gray-400 transition-all shadow-md">
                <span x-show="!isLoading">ðŸ’¾ Enregistrer</span>
                <span x-show="isLoading">Enregistrement...</span>
            </button>
        </div>
    </form>
</div>