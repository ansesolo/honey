<div class="flex justify-between items-center mb-6">
    <h2 class="text-3xl font-bold text-honey-800">Gestion des Clients</h2>
    <button
            @click="openCustomerForm()"
            class="bg-gradient-to-r from-honey-500 to-bee-500 text-white px-4 py-2 rounded-md hover:from-honey-600 hover:to-bee-600 transition-all shadow-md">
        ‚ûï Nouveau Client
    </button>
</div>

<!-- Message d'erreur global -->
<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4" x-show="error">
    <span x-text="error"></span>
</div>

<!-- Loading -->
<div class="text-center py-8" x-show="isLoading">
    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-honey-600"></div>
    <p class="text-gray-600 mt-2">Chargement...</p>
</div>

<!-- Tableau des clients -->
<div class="bg-white rounded-lg shadow overflow-hidden flex flex-col"
     style="height: calc(100vh - 280px);"
     x-show="!isLoading && !showCustomerForm">
    <!-- Tableau scrollable -->
    <div class="flex-1 overflow-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50 sticky top-0 z-10">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Pr√©nom
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Nom
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Email
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    T√©l√©phone
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Ville
                </th>
                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Actions
                </th>
            </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
            <template :key="customer.id" x-for="customer in paginatedItems">
                <tr @mouseenter="hoveredItem = customer" @mouseleave="hoveredItem = null"
                    class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                        x-text="customer.firstname"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                        x-text="customer.lastname"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600"
                        x-text="customer.email || '-'"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600"
                        x-text="customer.phone || '-'"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600"
                        x-text="customer.city || '-'"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm space-x-2">
                        <button
                                @click="viewCustomer(customer)"
                                class="text-honey-600 hover:text-honey-800 font-medium">
                            üëÅÔ∏è Voir
                        </button>
                        <button
                                @click="editCustomer(customer)"
                                class="text-bee-600 hover:text-bee-800 font-medium">
                            ‚úèÔ∏è √âditer
                        </button>
                        <button
                                @click="deleteCustomer(customer.id)"
                                class="text-red-600 hover:text-red-800 font-medium">
                            üóëÔ∏è Supprimer
                        </button>
                    </td>
                </tr>
            </template>
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div class="bg-gray-50 px-4 py-3 flex items-center justify-between border-t border-gray-200 sticky bottom-0"
         x-show="customers.length > 0">
        <!-- Info -->
        <div class="text-sm text-gray-700">
            Affichage de
            <span class="font-medium" x-text="((currentPage - 1) * itemsPerPage) + 1"></span>
            √†
            <span class="font-medium"
                  x-text="Math.min(currentPage * itemsPerPage, customers.length)"></span>
            sur
            <span class="font-medium" x-text="customers.length"></span>
            clients
        </div>

        <!-- Boutons -->
        <div class="flex items-center space-x-2">
            <!-- Pr√©c√©dent -->
            <button
                    :class="hasPreviousPage ? 'text-honey-600 hover:bg-honey-50' : 'text-gray-300 cursor-not-allowed'"
                    :disabled="!hasPreviousPage"
                    @click="previousPage()"
                    class="px-3 py-1 rounded border border-gray-300 text-sm font-medium transition">
                ‚Üê Pr√©c√©dent
            </button>

            <!-- Num√©ros de page -->
            <template :key="page" x-for="page in pageNumbers">
                <button
                        :class="currentPage === page ? 'bg-honey-500 text-white border-honey-500' : 'text-gray-700 hover:bg-gray-50 border-gray-300'"
                        @click="goToPage(page)"
                        class="px-3 py-1 rounded border text-sm font-medium transition"
                        x-show="page !== '...'"
                        x-text="page">
                </button>
                <span
                        class="px-2 text-gray-500"
                        x-show="page === '...'">
                                        ...
                </span>
            </template>

            <!-- Suivant -->
            <button
                    :class="hasNextPage ? 'text-honey-600 hover:bg-honey-50' : 'text-gray-300 cursor-not-allowed'"
                    :disabled="!hasNextPage"
                    @click="nextPage()"
                    class="px-3 py-1 rounded border border-gray-300 text-sm font-medium transition">
                Suivant ‚Üí
            </button>
        </div>
    </div>

    <!-- Message si aucun client -->
    <div class="text-center py-8 text-gray-500" x-show="customers.length === 0">
        Aucun client enregistr√©
    </div>
</div>

<!-- Formulaire Client -->
<div class="bg-white rounded-lg shadow-xl p-6 border-2 border-honey-200" x-show="showCustomerForm">
    <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-honey-800"
            x-text="selectedItem?.id ? '‚úèÔ∏è Modifier le client' : '‚ûï Nouveau client'"></h3>
        <button
                @click="closeCustomerForm()"
                class="text-gray-500 hover:text-gray-700">
            ‚úï
        </button>
    </div>

    <form @submit.prevent="saveCustomer" class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Pr√©nom <span class="text-red-500">*</span>
                </label>
                <input
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        required
                        type="text"
                        x-model="customerForm.firstname">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    Nom <span class="text-red-500">*</span>
                </label>
                <input
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        required
                        type="text"
                        x-model="customerForm.lastname">
            </div>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    type="email"
                    x-model="customerForm.email">
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">T√©l√©phone</label>
            <input
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    type="tel"
                    x-model="customerForm.phone">
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Rue</label>
            <input
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    type="text"
                    x-model="customerForm.street">
        </div>

        <div class="grid grid-cols-3 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Code postal</label>
                <input
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        type="text"
                        x-model="customerForm.postalCode">
            </div>

            <div class="col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">Ville</label>
                <input
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        type="text"
                        x-model="customerForm.city">
            </div>
        </div>

        <div class="flex justify-end space-x-3 pt-4">
            <button
                    @click="closeCustomerForm()"
                    class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition"
                    type="button">
                Annuler
            </button>
            <button
                    :disabled="isLoading"
                    class="px-4 py-2 bg-gradient-to-r from-honey-500 to-bee-500 text-white rounded-md hover:from-honey-600 hover:to-bee-600 disabled:bg-gray-400 transition-all shadow-md"
                    type="submit">
                <span x-show="!isLoading">üíæ Enregistrer</span>
                <span x-show="isLoading">Enregistrement...</span>
            </button>
        </div>
    </form>
</div>

<!-- Modal de d√©tail client -->
<div @click.self="showCustomerDetail = false"
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
     x-show="showCustomerDetail">
    <div class="bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full mx-4 border-4 border-honey-400">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-honey-800">üë§ D√©tails du client</h3>
            <button
                    @click="showCustomerDetail = false"
                    class="text-gray-500 hover:text-gray-700 text-2xl">
                ‚úï
            </button>
        </div>

        <template x-if="selectedItem">
            <div class="space-y-3">
                <div>
                    <span class="text-sm text-gray-500">Nom complet:</span>
                    <p class="font-medium text-lg"
                       x-text="`${selectedItem.firstname} ${selectedItem.lastname}`"></p>
                </div>
                <div>
                    <span class="text-sm text-gray-500">Email:</span>
                    <p class="font-medium" x-text="selectedItem.email || '-'"></p>
                </div>
                <div>
                    <span class="text-sm text-gray-500">T√©l√©phone:</span>
                    <p class="font-medium" x-text="selectedItem.phone || '-'"></p>
                </div>
                <div>
                    <span class="text-sm text-gray-500">Adresse:</span>
                    <p class="font-medium" x-text="formatAddress(selectedItem)"></p>
                </div>
            </div>
        </template>

        <div class="mt-6 flex justify-end">
            <button
                    @click="showCustomerDetail = false"
                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition">
                Fermer
            </button>
        </div>
    </div>
</div>
